{% extends "wiki_base.html" %}
{% block content %}
<!-- Persistent top toolbar â€” always visible regardless of sidebar state -->
<div class="wiki-toolbar" id="wiki-toolbar">
    <button class="toolbar-btn toolbar-btn-compact" id="sidebar-toggle" aria-label="Toggle sidebar" title="Toggle sidebar">&#9776;</button>
    <button class="toolbar-btn toolbar-btn-compact" id="theme-toggle" aria-label="Toggle dark/light mode" title="Toggle dark/light mode">
        <span class="theme-icon-dark">&#9790;</span>
        <span class="theme-icon-light">&#9728;</span>
    </button>
    <a href="/wiki/{{ repo_alias }}/" class="toolbar-home">{{ repo_alias }} Wiki Home</a>
    <div class="toolbar-spacer"></div>
</div>
<div class="wiki-page">
    <!-- Sidebar -->
    <nav class="wiki-sidebar" id="wiki-sidebar" data-current-path="{{ current_path }}">
        <!-- Search box (Story #290) -->
        <div class="wiki-search-box" id="wiki-search-box">
            <div class="wiki-search-row">
                <input type="text" id="wiki-search-input" class="wiki-search-input"
                       placeholder="Search articles..." autocomplete="off" />
                <select id="wiki-search-mode" class="wiki-search-mode">
                    <option value="fts">Full Text Search</option>
                    <option value="semantic" selected>Semantic</option>
                </select>
                <button id="wiki-search-clear" class="wiki-search-clear" style="display:none"
                        aria-label="Clear search" title="Clear search">&times;</button>
            </div>
            <div id="wiki-search-status" class="wiki-search-status" style="display:none"></div>
        </div>
        {% if sidebar %}
        {% for group in sidebar %}
        <div class="sidebar-group" data-group="{{ group.name }}">
            <div class="sidebar-group-header">
                <span class="toc-chevron"></span>{{ group.name }}
            </div>
            <div class="sidebar-group-items">
                {% for cat_name, cat_articles in group.categories.items() %}
                <div class="sidebar-category collapsed" data-section-id="{{ group.name }}-{{ cat_name | replace(' ', '-') | lower }}">
                    <div class="sidebar-category-header">
                        <span class="toc-chevron"></span>{{ cat_name }}
                    </div>
                    <div class="sidebar-category-items">
                        {% for article in cat_articles %}
                        <a href="/wiki/{{ repo_alias }}/{{ article.path }}"
                           class="sidebar-item {% if article.path == current_path %}active{% endif %}"
                           data-path="{{ article.path }}">
                            {{ article.title }}
                        </a>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
        {% endif %}

        <!-- Recently Viewed (populated by wiki.js) -->
        <div class="sidebar-recently-viewed" id="recently-viewed">
            <div class="sidebar-group-header">Recently Viewed</div>
            <div class="sidebar-group-items" id="recently-viewed-items"></div>
        </div>
    </nav>
    <!-- Drag handle for sidebar resize (Story #294) -->
    <div class="wiki-sidebar-handle" id="wiki-sidebar-handle"></div>

    <!-- Main Content -->
    <div class="wiki-main">
        <!-- Breadcrumbs -->
        {% if breadcrumbs %}
        <nav class="wiki-breadcrumbs" aria-label="Breadcrumb">
            {% for crumb in breadcrumbs %}
            {% if not loop.last %}
            <a href="{{ crumb.url }}">{{ crumb.label }}</a>
            <span class="breadcrumb-sep">/</span>
            {% else %}
            <span class="breadcrumb-current">{{ crumb.label }}</span>
            {% endif %}
            {% endfor %}
        </nav>
        {% endif %}

        <div class="wiki-content">
            <h1>{{ title }}</h1>
            {% if metadata_panel %}
            <details class="wiki-metadata-panel">
                <summary class="metadata-summary">Article Metadata</summary>
                <dl class="metadata-list">
                    {% for label, value in metadata_panel %}
                    <div class="metadata-row">
                        <dt>{{ label }}</dt>
                        <dd>{{ value }}</dd>
                    </div>
                    {% endfor %}
                </dl>
            </details>
            {% endif %}
            {{ content | safe }}
        </div>
    </div>
</div>
{% endblock %}
