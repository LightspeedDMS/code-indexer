{% extends "wiki_base.html" %}
{% block content %}
<!-- Persistent top toolbar â€” always visible regardless of sidebar state -->
<div class="wiki-toolbar" id="wiki-toolbar">
    <button class="toolbar-btn" id="sidebar-toggle" aria-label="Toggle sidebar" title="Toggle sidebar">&#9776;</button>
    <a href="/wiki/{{ repo_alias }}/" class="toolbar-home">Wiki Home</a>
    <div class="toolbar-spacer"></div>
    <button class="toolbar-btn" id="theme-toggle" aria-label="Toggle dark/light mode" title="Toggle dark/light mode">
        <span class="theme-icon-dark">&#9790;</span>
        <span class="theme-icon-light">&#9728;</span>
    </button>
</div>
<div class="wiki-page">
    <!-- Sidebar -->
    <nav class="wiki-sidebar" id="wiki-sidebar">
        {% if sidebar %}
        {% for group in sidebar %}
        <div class="sidebar-group" data-group="{{ group.name }}">
            <div class="sidebar-group-header" onclick="this.parentElement.classList.toggle('collapsed')">
                {{ group.name }}
            </div>
            <div class="sidebar-group-items">
                {% for article in group.articles %}
                <a href="/wiki/{{ repo_alias }}/{{ article.path }}"
                   class="sidebar-item {% if article.path == current_path %}active{% endif %}">
                    {{ article.title }}
                </a>
                {% endfor %}
                {% for cat_name, cat_articles in group.categories.items() %}
                <div class="sidebar-category">
                    <div class="sidebar-category-header" onclick="this.parentElement.classList.toggle('collapsed')">
                        {{ cat_name }}
                    </div>
                    <div class="sidebar-category-items">
                        {% for article in cat_articles %}
                        <a href="/wiki/{{ repo_alias }}/{{ article.path }}"
                           class="sidebar-item {% if article.path == current_path %}active{% endif %}">
                            {{ article.title }}
                        </a>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
        {% endif %}

        <!-- Recently Viewed (populated by wiki.js) -->
        <div class="sidebar-recently-viewed" id="recently-viewed">
            <div class="sidebar-group-header">Recently Viewed</div>
            <div class="sidebar-group-items" id="recently-viewed-items"></div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="wiki-main">
        <!-- Breadcrumbs -->
        {% if breadcrumbs %}
        <nav class="wiki-breadcrumbs" aria-label="Breadcrumb">
            {% for crumb in breadcrumbs %}
            {% if not loop.last %}
            <a href="{{ crumb.url }}">{{ crumb.label }}</a>
            <span class="breadcrumb-sep">/</span>
            {% else %}
            <span class="breadcrumb-current">{{ crumb.label }}</span>
            {% endif %}
            {% endfor %}
        </nav>
        {% endif %}

        <div class="wiki-content">
            <h1>{{ title }}</h1>
            {{ content | safe }}
        </div>
    </div>
</div>
{% endblock %}
